{# --- 1. 配置区 --- #}
{% set repo_url = "https://github.com/MontageSubs/wiki" %}
{% set file_path = page.file.src_uri %}
{% set wiki_page = file_path | replace("index.md", "Home") | replace(".md", "") %}
{% set target_edit_url = repo_url ~ "/wiki/" ~ wiki_page ~ "/_edit" %}
{% set login_edit_url = "https://github.com/login?return_to=" ~ (target_edit_url | urlencode) %}

<div class="action-wrapper" data-search-ignore role="complementary">
  <input type="checkbox" id="action-menu-toggle" autocomplete="off" hidden aria-hidden="true">
  
  <label for="action-menu-toggle" class="action-overlay-mask"></label>

  <div class="action-container">
    <div class="action-icons-row">
      <label for="action-menu-toggle" class="icon-btn-trigger" title="贡献与编辑">
        {% include ".icons/material/file-document-edit-outline.svg" %}
      </label>
      
      <a href="{{ repo_url }}/wiki/{{ wiki_page }}/_history" class="icon-btn-trigger" target="_blank" rel="noopener" title="查看编辑历史">
        {% include ".icons/material/history.svg" %}
      </a>
    </div>

    <aside class="gh-popup-menu" aria-hidden="true">
      <div class="gh-popup-arrow"></div>
      <div class="gh-popup-box">
        <div class="gh-popup-header">
          <strong>参与百科贡献</strong>
          <p>一本众创、共建、同享的字幕百科</p>
        </div>
        
        <div class="gh-popup-body">
          <a href="{{ login_edit_url }}" class="gh-btn-github" target="_blank" rel="noopener">使用 GitHub 账号编辑</a>
          <nav class="gh-links-nav">
            <a href="{{ '百科语法指南/' | url }}">百科语法指南</a>
            <a href="{{ 'GitHub-帮助指南/' | url }}">GitHub 帮助指南</a>
            <a href="{{ '贡献指南/' | url }}">贡献指南</a>
          </nav>
        </div>
      </div>
    </aside>
  </div>
</div>
