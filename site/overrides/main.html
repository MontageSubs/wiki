{% extends "base.html" %}
{% block content %}
  {% set repo_url = "https://github.com/MontageSubs/wiki/wiki" %}
  {% set file_path = page.file.src_uri %}
  {% set wiki_page = file_path | replace("index.md", "Home") | replace(".md", "") %}

  <nav class="md-content__articles" style="float: right; display: flex; gap: 8px; position: relative; z-index: 10;">
    <button onclick="document.getElementById('edit-dialog').showModal()" title="贡献与编辑" class="md-content__button md-icon" style="background: none; border: none; cursor: pointer; padding: 0; color: var(--md-icon-fg-color);">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"></path></svg>
    </button>
    <a href="{{ repo_url }}/{{ wiki_page }}/_history" title="查看本页编辑历史" class="md-content__button md-icon" style="color: var(--md-icon-fg-color);">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 3a9 9 0 0 0-9 9H1l3.96 4.07.04.03L9 12H6a7 7 0 0 1 7-7 7 7 0 0 1 7 7 7 7 0 0 1-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42A8.954 8.954 0 0 0 13 21a9 9 0 0 0 9-9 9 9 0 0 0-9-9z"></path></svg>
    </a>
  </nav>

  <dialog id="edit-dialog" style="border: 1px solid var(--md-divider-color); border-radius: 12px; padding: 24px; box-shadow: 0 10px 40px rgba(0,0,0,0.2); width: 90%; max-width: 360px; font-family: inherit; background: var(--md-default-bg-color); color: var(--md-default-fg-color);">
    <div style="text-align: center; margin-bottom: 20px;">
      <h3 style="margin: 0; font-size: 1.2rem; color: var(--md-default-fg-color); font-weight: 700;">参与百科编辑</h3>
    </div>
    
    <div style="display: flex; flex-direction: column; gap: 10px;">
      <a href="{{ repo_url }}/{{ wiki_page }}/_edit" class="gh-btn-primary" style="color: #ffffff !important; padding: 12px; border-radius: 6px; text-align: center; text-decoration: none; font-size: 0.9rem; font-weight: 600; display: block; border: 1px solid rgba(27, 31, 35, 0.15);">已登录 GitHub？立即编辑</a>
      
      <a href="https://github.com/login?return_to={{ (repo_url ~ '/' ~ wiki_page ~ '/_edit') | urlencode }}" class="gh-btn-secondary" style="padding: 12px; border-radius: 6px; text-align: center; text-decoration: none; font-size: 0.9rem; font-weight: 600; display: block; border: 1px solid var(--md-divider-color);">未登录？点此登录后编辑</a>
    </div>

    <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid var(--md-divider-color);">
      <ul style="font-size: 0.8rem; padding-left: 1.2rem; line-height: 2; margin: 0;">
        <li><a href="{{ repo_url }}/百科语法指南" style="color: var(--md-typeset-a-color); text-decoration: none;">百科语法指南</a></li>
        <li><a href="{{ repo_url }}/GitHub-帮助指南" style="color: var(--md-typeset-a-color); text-decoration: none;">GitHub 帮助指南</a></li>
        <li><a href="{{ repo_url }}/贡献指南" style="color: var(--md-typeset-a-color); text-decoration: none;">贡献指南</a></li>
      </ul>
    </div>

    <button onclick="this.closest('dialog').close()" style="margin-top: 20px; width: 100%; padding: 10px; border: 1px solid var(--md-divider-color); background: var(--md-code-bg-color); color: var(--md-default-fg-color); cursor: pointer; border-radius: 8px; font-size: 0.85rem; font-weight: 500;">关闭窗口</button>
  </dialog>

  <style>
    /* 按钮 1: GitHub 绿色风格 */
    .gh-btn-primary { background-color: #1f883d; }
    .gh-btn-primary:hover { background-color: #1a7a35; }
    [data-md-color-scheme="slate"] .gh-btn-primary { background-color: #238636; }
    [data-md-color-scheme="slate"] .gh-btn-primary:hover { background-color: #2ea043; }

    /* 按钮 2: GitHub 灰色风格 */
    .gh-btn-secondary { 
      background-color: #f6f8fa; 
      color: #24292f !important; 
    }
    .gh-btn-secondary:hover { background-color: #f3f4f6; }

    /* 按钮 2: 深色模式适配 */
    [data-md-color-scheme="slate"] .gh-btn-secondary { 
      background-color: #212830; 
      color: #adbac7 !important; 
      border-color: #444c56;
    }
    [data-md-color-scheme="slate"] .gh-btn-secondary:hover { 
      background-color: #262c36; 
      border-color: #768390;
    }
  </style>

  {{ super() }}
{% endblock %}
