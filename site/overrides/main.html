{% extends "base.html" %}
{% block content %}
  {% set repo_url = "https://github.com/MontageSubs/wiki/wiki" %}
  {% set file_path = page.file.src_uri %}
  {% set wiki_page = file_path | replace("index.md", "Home") | replace(".md", "") %}

  <nav class="md-content__articles" style="float: right; display: flex; gap: 8px; position: relative; z-index: 10;">
    <button onclick="document.getElementById('edit-dialog').showModal()" title="è´¡çŒ®ä¸ç¼–è¾‘" class="md-content__button md-icon" style="background: none; border: none; cursor: pointer; padding: 0; color: var(--md-icon-fg-color);">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"></path></svg>
    </button>
    <a href="{{ repo_url }}/{{ wiki_page }}/_history" title="æŸ¥çœ‹æœ¬é¡µç¼–è¾‘å†å²" class="md-content__button md-icon" style="color: var(--md-icon-fg-color);">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 3a9 9 0 0 0-9 9H1l3.96 4.07.04.03L9 12H6a7 7 0 0 1 7-7 7 7 0 0 1 7 7 7 7 0 0 1-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42A8.954 8.954 0 0 0 13 21a9 9 0 0 0 9-9 9 9 0 0 0-9-9z"></path></svg>
    </a>
  </nav>

  <dialog id="edit-dialog" style="border: 1px solid var(--md-divider-color); border-radius: 12px; padding: 24px; box-shadow: 0 20px 50px rgba(0,0,0,0.3); width: 90%; max-width: 360px; font-family: inherit; background: var(--md-default-bg-color); color: var(--md-default-fg-color); outline: none;">
    <div style="text-align: center; margin-bottom: 24px;">
      <h3 style="margin: 0; font-size: 1.25rem; color: var(--md-default-fg-color); font-weight: 700; letter-spacing: -0.02em;">å‚ä¸ç™¾ç§‘ç¼–è¾‘</h3>
      <p style="font-size: 0.75rem; opacity: 0.6; margin-top: 4px;">è¯·é€‰æ‹©åˆé€‚çš„ç¼–è¾‘æ–¹å¼</p>
    </div>
    
    <div style="display: flex; flex-direction: column; gap: 12px;">
      <a href="{{ repo_url }}/{{ wiki_page }}/_edit" class="gh-btn-primary" style="color: #ffffff !important; padding: 12px; border-radius: 6px; text-align: center; text-decoration: none; font-size: 0.9rem; font-weight: 600; display: block; border: 1px solid rgba(27, 31, 35, 0.15); transition: all 0.2s;">å·²ç™»å½• GitHubï¼Ÿç«‹å³ç¼–è¾‘</a>
      
      <a href="https://github.com/login?return_to={{ (repo_url ~ '/' ~ wiki_page ~ '/_edit') | urlencode }}" class="gh-btn-secondary" style="padding: 12px; border-radius: 6px; text-align: center; text-decoration: none; font-size: 0.9rem; font-weight: 600; display: block; border: 1px solid var(--md-divider-color); transition: all 0.2s;">æœªç™»å½•ï¼Ÿç‚¹æ­¤ç™»å½•åç¼–è¾‘</a>
    </div>

    <div style="margin-top: 24px; padding: 16px; background: var(--md-code-bg-color); border-radius: 8px;">
      <p style="font-size: 0.7rem; font-weight: bold; text-transform: uppercase; margin: 0 0 8px 0; opacity: 0.5;">ç¼–è¾‘æŒ‡å—</p>
      <ul class="dialog-links" style="list-style: none; padding: 0; margin: 0; font-size: 0.85rem; line-height: 1.8;">
        <li><a href="{{ repo_url }}/ç™¾ç§‘è¯­æ³•æŒ‡å—">ğŸ“– ç™¾ç§‘è¯­æ³•æŒ‡å—</a></li>
        <li><a href="{{ repo_url }}/GitHub-å¸®åŠ©æŒ‡å—">ğŸ› ï¸ GitHub å¸®åŠ©æŒ‡å—</a></li>
        <li><a href="{{ repo_url }}/è´¡çŒ®æŒ‡å—">ğŸ¤ è´¡çŒ®æŒ‡å—</a></li>
      </ul>
    </div>

    <button onclick="this.closest('dialog').close()" class="gh-btn-secondary" style="margin-top: 24px; width: 100%; padding: 10px; cursor: pointer; border-radius: 6px; font-size: 0.85rem; font-weight: 600; border: 1px solid var(--md-divider-color); transition: all 0.2s;">å…³é—­çª—å£</button>
  </dialog>

  <style>
    /* åŸºç¡€æŒ‰é’®äº¤äº’ */
    .gh-btn-primary, .gh-btn-secondary { -webkit-font-smoothing: antialiased; }
    .gh-btn-primary:active, .gh-btn-secondary:active { transform: scale(0.98); }

    /* ç»¿è‰²ä¸»æŒ‰é’® (å¯¹é½ GitHub) */
    .gh-btn-primary { background-color: #1f883d; }
    .gh-btn-primary:hover { background-color: #1a7a35; box-shadow: 0 4px 12px rgba(31, 136, 61, 0.2); }
    [data-md-color-scheme="slate"] .gh-btn-primary { background-color: #238636; }
    [data-md-color-scheme="slate"] .gh-btn-primary:hover { background-color: #2ea043; box-shadow: 0 4px 12px rgba(35, 134, 54, 0.3); }

    /* ç°è‰²æ¬¡è¦æŒ‰é’® (å¯¹é½ GitHub) */
    .gh-btn-secondary { background-color: #f6f8fa; color: #24292f !important; }
    .gh-btn-secondary:hover { background-color: #f3f4f6; border-color: var(--md-typeset-a-color); }
    [data-md-color-scheme="slate"] .gh-btn-secondary { background-color: #212830; color: #adbac7 !important; border-color: #444c56; }
    [data-md-color-scheme="slate"] .gh-btn-secondary:hover { background-color: #262c36; border-color: #768390; }

    /* ç¼–è¾‘æŒ‡å—é“¾æ¥ç¾åŒ– */
    .dialog-links a { color: var(--md-typeset-a-color); text-decoration: none; display: block; transition: transform 0.2s; }
    .dialog-links a:hover { transform: translateX(4px); color: var(--md-accent-fg-color); }

    /* å¢å¼ºé›¾é¢æ•ˆæœ */
    dialog::backdrop {
      background: rgba(0, 0, 0, 0.3);
      backdrop-filter: blur(4px);
      -webkit-backdrop-filter: blur(4px);
    }
  </style>

  {{ super() }}
{% endblock %}
