<a href=""
   id="gh-create-entry-btn"
   class="md-search-result__create-btn"
   style="display: none;"
   target="_blank">
  创建条目
</a>

<script>
  (function() {
    const BASE_URL = "https://github.com/MontageSubs/wiki/wiki/";
    const LOGIN_PREFIX = "https://github.com/login?return_to=";

    function setupCreateButton() {
      const resultMeta = document.querySelector(".md-search-result__meta");
      const searchInput = document.querySelector(".md-search__input");
      const createBtn = document.getElementById("gh-create-entry-btn");

      if (!resultMeta || !searchInput || !createBtn) return;

      // 防止重复绑定
      if (resultMeta.dataset.hasObserver) return;
      resultMeta.dataset.hasObserver = "true";

      const observer = new MutationObserver(() => {
        const query = searchInput.value.trim();
        // 兼容不同的搜索结果提示文本
        const isNoResult = resultMeta.textContent.includes("没有找到") || 
                           resultMeta.textContent.includes("No results");
        
        if (isNoResult && query.length > 0) {
          const targetUrl = BASE_URL + encodeURIComponent(query);
          createBtn.href = LOGIN_PREFIX + encodeURIComponent(targetUrl);
          
          // 如果按钮不在 meta 容器里，把它搬进去
          if (createBtn.parentElement !== resultMeta) {
            resultMeta.appendChild(createBtn);
          }
          createBtn.style.display = "inline-flex";
        } else {
          createBtn.style.display = "none";
        }
      });

      observer.observe(resultMeta, { childList: true, characterData: true, subtree: true });
    }

    // 尝试立即执行
    setupCreateButton();

    // 监听 Material 主题的页面切换事件 (Instant Loading)
    if (window.app$) {
      app$.subscribe(function() {
        // 使用 setTimeout 确保 DOM 已经渲染完毕
        setTimeout(setupCreateButton, 100);
      });
    }
  })();
</script>
