{% extends "base.html" %}

{% block scripts %}
  {{ super() }}
  {# 搜索改进 #}
  {% include "partials/custom-search.html" %}
  {# 日期改进 #}
  {% include "partials/custom-date.html" %}

  <script>
    (function() {
      // 定义注入函数
      function injectCustomHeader() {
        var anchor = document.getElementById("hd-action-js-anchor");
        if (!anchor || document.getElementById("hd-action-toggle")) return;

        // 构建与 No-JS 相同的 HTML 结构
        var html = `
          <div class="hd-action-wrapper">
            <input type="checkbox" id="hd-action-toggle" autocomplete="off" hidden aria-hidden="true">
            <label for="hd-action-toggle" class="hd-overlay-mask"></label>
            <div class="hd-action-container">
              <label for="hd-action-toggle" class="md-header__button md-icon" title="新增条目">
                <span class="twemoji">{% include ".icons/material/plus.svg" %}</span>
              </label>
              <aside class="hd-popup-menu" aria-hidden="true">
                <div class="hd-popup-arrow"></div>
                <div class="hd-popup-box">
                  <div class="hd-popup-header">
                    <strong>参与百科贡献</strong>
                    <p>一本众创、共建、同享的字幕百科</p>
                  </div>
                  <div class="hd-popup-body">
                    <a href="{{ login_new_url }}" class="hd-btn-github" target="_blank">使用 GitHub 创建新条目</a>
                    <nav class="hd-links-nav">
                      <a href="{{ '百科语法指南/' | url }}">百科语法指南</a>
                      <a href="{{ 'GitHub-帮助指南/' | url }}">GitHub 帮助指南</a>
                      <a href="{{ '贡献指南/' | url }}">贡献指南</a>
                    </nav>
                  </div>
                </div>
              </aside>
            </div>
          </div>
        `;
        anchor.outerHTML = html; 
      }

      // 1. 立即执行（用于初次进入页面）
      if (document.readyState === "loading") {
        document.addEventListener("DOMContentLoaded", injectCustomHeader);
      } else {
        injectCustomHeader();
      }

      // 2. 兼容 Material 的 Instant Loading (SPA 模式)
      if (typeof app$ !== "undefined") {
        app$.subscribe(function() {
          injectCustomHeader();
        });
      }
    })();
  </script>
{% endblock %}
